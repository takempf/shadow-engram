---
import { db, Contact, eq } from 'astro:db';
// slugify import is no longer needed here directly, it's in slugUtils
import { generateUniqueSlug } from '../../utils/slugUtils';

// Removed local generateUniqueSlug function

if (Astro.request.method === 'POST') {
  const formData = await Astro.request.formData();
  const name = formData.get('name') as string;
  const email = formData.get('email') as string;
  const phone = formData.get('phone') as string;

  // Call the imported function. For add-contact, excludeId is not needed (or can be null).
  const slug = await generateUniqueSlug(name);

  await db.insert(Contact).values({ name, email, phone, slug });
  return Astro.redirect('/');
}
---
<form method="POST">
  <label for="name">Name:</label>
  <input type="text" id="name" name="name" required />

  <label for="email">Email:</label>
  <input type="email" id="email" name="email" required />

  <label for="phone">Phone:</label>
  <input type="tel" id="phone" name="phone" />

  <button type="submit">Add Contact</button>
</form>