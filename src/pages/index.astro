---
// src/pages/index.astro
import { db, Contact } from 'astro:db';
import slugify from 'slugify';

const contacts = await db.select().from(Contact);
---
<h1>My Contacts</h1>
<ul>
  {contacts.map(contact => {
    const slug = slugify(contact.name, { lower: true, strict: true });
    return (
    <li>
      <strong><a href={`/contacts/${slug}`}>{contact.name}</a></strong><br/>
      Email: {contact.email}<br/>
      {contact.phone && `Phone: ${contact.phone}`}
      <a href={`/edit-contact/${contact.id}`}>Edit</a>
      <form method="POST" action={`/delete-contact/${contact.id}`}>
        <button type="submit">Delete</button>
      </form>
    </li>
    );
  })}
</ul>
<a href="/add-contact">Add New Contact</a>